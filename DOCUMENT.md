# SauScript 文档

## 程序

SauScript 是一种脚本语言，经编译成语法树之后即可执行。

SauScript 编译文件时，第一行代码即为程序的入口。最后一行代码即为程序的出口。

SauScript 也提供了 REPL 程序可以即时求值。

## A + B 问题

下面这个程序将会从控制台输入两个整数，并输出他们的和

```
a := 0
b := 0
input a
input b
print a + b
```

在这段程序中 `:=` 运算符用于创建并初始化变量，变量的类型根据初始化的值推导。本语言共四种类型，分别是 `void int real func` 空、整型、实数型、函数。在参与运算的时候，整型可能会根据情况提升为实数型，其它任何隐式转换都是不允许的。你可以显式调用 `int()` 函数取整。还有其它更多取整和转换函数参见附录。

在 SauScript 中，万物皆为表达式。赋值运算符返回的是改对象的左值。因此上面的代码可以简写为：

```
input a := 0
input b := 0
print a + b
```

运算符的优先级和结合性详见附录。

## 计算 e

下面这个程序会计算自然对数的底数 e：

```
# e = 1 + 1/1 + 1/2 + 1/6 + .. + 1/n!
e := 1.0
p := 1.0
for i := 1; i < 100; ++i {
    p *= i
    e += 1.0 / p
}
print e
```

实际上，仅保留最后一行，程序依然可以正常输出，因为 SauScript 的全局定义了不少常用的数学常量。除此之外，你还可以选择用 `exp(1)` 来表示这个常数。SauScript 的全局也定义了不少常用的数学函数。他们是通过外部函数的方式引入的。这些数学常量和外部函数详见附录。

同一个作用域下变量不可以重名，但是全局作用域实际上是默认作用域的父作用域。SauScript 允许在子作用域中使用相同的名字 shadow 父作用域中的名字。

## 素数判断

下面这个程序会判断输入数字以下的整数是否为素数。素数则输出本身，非素数则输出相反数。

```
isPrime := function(t: int): int {
    if t < 2 {
        return false
    }
    for i := 2; i * i <= t; ++i {
        if t % i == 0 {
            return false
        }
    }
    return true
}

input m := 0
for i := 1; i < m; ++i {
    print if isPrime(i) {
        i
    } else {
        -i
    }
}
```

程序开头定义了一个判断素数的函数。变量和返回值的类型必须写出。

你可能以及注意到 if 表达式的使用，你如果不喜欢这个风格也可以用三目运算符。

在 SauScript 里面，万物皆为表达式，不仅仅是 if-else，其它所有流程控制都是表达式。

流程控制的具体使用方法详见附录。

### 语法树

SauScript 附带了语法树生成功能。素数判断的代码的语法树如下所示：

![](syntax-tree.svg)

# 附录

## 运算符和字面量

SauScript 的运算符和字面量优先级从低到高：

| 优先级 | 运算符                                                       | 结合性   |
| ------ | ------------------------------------------------------------ | -------- |
| 0      | `print input throw yield return`<br>`:= =`<br>`+= -= *= /= %= >>= <<= &= ^= |=`<br/>`?:` |从右到左 |
| 1      | `||`                                                         | 从左到右 |
| 2      | `&&`                                                         | 从左到右 |
| 3      | `|`                                                          | 从左到右 |
| 4      | `^`                                                          | 从左到右 |
| 5      | `&`                                                          | 从左到右 |
| 6      | `== !=`                                                      | 从左到右 |
| 7      | `< > <= >=`                                                  | 从左到右 |
| 8      | `<< >>`                                                      | 从左到右 |
| 9      | `+ -`                                                        | 从左到右 |
| 10     | `* / %`                                                      | 从左到右 |
| 11     | `! ~`<br>`+ - ++ --`（前缀）                                 | 从右到左 |
| 12     | `++ --`（后缀）<br>`()`（函数调用）                          | 从左到右 |
| 13 | `true false __LINE__ nan inf continue break function`<br/>`if-else try-catch while do-while for` | 从左到右 |

